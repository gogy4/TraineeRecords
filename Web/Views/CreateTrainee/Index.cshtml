@model TraineeViewModel

@{
    ViewData["Title"] = "Создать нового стажера";
}

@if (!string.IsNullOrEmpty(Model.Success))
{
    <div class="alert alert-success">@Model.Success</div>
}

@if (!string.IsNullOrEmpty(Model.Errors))
{
    <div class="alert alert-danger">@Model.Errors</div>
}

<h2>@ViewData["Title"]</h2>

<form id="traineeForm" method="post" asp-action="CreateTrainee">
    @Html.AntiForgeryToken()

    <div>
        <label for="name">Имя:</label>
        <input type="text" id="name" name="Name" required/>
    </div>

    <div>
        <label for="surname">Фамилия:</label>
        <input type="text" id="surname" name="Surname" required/>
    </div>

    <div>
        <label for="gender">Пол:</label>
        <select id="gender" name="Gender" required>
            <option value="">Выберите пол</option>
            <option value="Мужской">Мужской</option>
            <option value="Женский">Женский</option>
        </select>
    </div>

    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="Email" required/>
    </div>

    <div>
        <label for="phoneNumber">Номер телефона:</label>
        <input type="text" id="phoneNumber" name="PhoneNumber" placeholder="+7XXXXXXXXXX"/>
    </div>

    <div>
        <label for="dateOfBirth">Дата рождения:</label>
        <input type="date" id="dateOfBirth" name="DateOfBirth" required/>
    </div>

    <div>
        <label for="internshipDirectionName">Направление стажировки:</label>
        <select id="internshipDirectionName" name="InternshipDirectionName" required>
            <option value="">Выберите направление</option>
            @foreach (var direction in Model.InternshipDirections)
            {
                <option value="@direction">@direction</option>
            }
        </select>
        <input type="text" id="newInternshipDirectionName" placeholder="Добавить новое направление"/>
        <button type="button" id="addInternshipDirectionName">+</button>
    </div>

    <div>
        <label for="currentProjectName">Текущий проект:</label>
        <select id="currentProjectName" name="CurrentProjectName" required>
            <option value="">Выберите проект</option>
            @foreach (var project in Model.Projects)
            {
                <option value="@project">@project</option>
            }
        </select>
        <input type="text" id="newCurrentProjectName" placeholder="Добавить новый проект"/>
        <button type="button" id="addCurrentProjectName">+</button>
    </div>

    <button type="submit">Создать стажера</button>
</form>


<script>
    async function postData(url, data) {
        let response = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        return response;
    }

    document.getElementById("addInternshipDirectionName").addEventListener("click", async function () {
        var newDirection = document.getElementById("newInternshipDirectionName").value.trim();
        if (newDirection) {
            let response = await postData('/CreateNewResource/AddInternshipDirection', newDirection);
            if (response) {
                var select = document.getElementById("internshipDirectionName");
                var option = document.createElement("option");
                option.value = newDirection;
                option.textContent = newDirection;
                select.appendChild(option);
                select.value = newDirection;
                document.getElementById("newInternshipDirectionName").value = "";
            }
        }
    });

    document.getElementById("addCurrentProjectName").addEventListener("click", async function () {
        var newProject = document.getElementById("newCurrentProjectName").value.trim();
        if (newProject) {
            let response = await postData('/CreateNewResource/AddCurrentProject', newProject);
            if (response) {
                var select = document.getElementById("currentProjectName");
                var option = document.createElement("option");
                option.value = newProject;
                option.textContent = newProject;
                select.appendChild(option);
                select.value = newProject;
                document.getElementById("newCurrentProjectName").value = "";
            }
        }
    });

</script>